---
title: "R Notebook"
output: html_notebook
---


```{r}
library(ggplot2)

library(readxl)
library(ggplot2)
library(dplyr)

```
wczytywanie danych
```{r}
pyly <- read_excel("C:/Users/51727/Desktop/licencjat/DanePyly2013-2017.xlsx") %>%                       mutate(czas=as_date(czas)) %>%                                                      select(czas,MzWarTolstojPM10_24g,MzWarKondratPM25_24g)
head(pyly)
colnames(pyly,do.NULL = TRUE,prefix = "col") 
library(lubridate)
pogoda_pyly <- inner_join(pogoda_wawa, pyly)
```

imputacja danych dla pyłów

```{r}
library(VIM)
pogoda_pyly_imp <- kNN(data = pogoda_pyly, 
                 variable = c("MzWarKondratPM25_24g", "MzWarTolstojPM10_24g"), 
                 k = 20, 
                 numFun = median, 
                 dist_var = c("temp", "wilgotnosc", "wiatr", "chmury", "MzWarKondratPM25_24g",  "MzWarTolstojPM10_24g"))

summary(pogoda_pyly_imp)


```
Dodanie dnia tygodnia i dni weekendowych
```{r}
pogoda_pyly_imp <- pogoda_pyly_imp %>% mutate(dzien_tygodnia=weekdays(czas),czyWeekend=ifelse(dzien_tygodnia=="sobota"|dzien_tygodnia=="niedziela",TRUE,FALSE))
summary(pogoda_pyly_imp)

```

podział danych na dane trenujące i testowe
```{r}
train <- pogoda_pyly_imp %>%
  filter(year(czas) < 2017)

summary(train)

test <- pogoda_pyly_imp %>%
  filter(year(czas) == 2017)

summary(test)
```


```{r}
ggplot(data=pogoda_pyly_imp, aes(x=czas,y=MzWarKondratPM25_24g))+geom_point()

```

```{r}
ggplot(data=pogoda_pyly_imp, aes(x=czas,y=MzWarTolstojPM10_24g))+geom_point()
```



Wyznaczenie linii wielomianu dla pogody
```{r}
library(stats)
library(splines)
library(dplyr)
library(grid)
library(tibble)
library(ggplot2)
library(modelr)
library(tidyverse)
library(tidyr)
#MzWarKondratPM25_24g

MzWarKondrat <- pyly %>% select(x=czas, y=MzWarKondratPM25_24g)


mod1 <-lm(y ~ ns(x, df=1), data=MzWarKondrat)
mod2 <-lm(y ~ ns(x, 2), data=MzWarKondrat)
mod3 <-lm(y ~ ns(x, 3), data=MzWarKondrat)
mod4 <-lm(y ~ ns(x, 4), data=MzWarKondrat)
mod5 <-lm(y ~ ns(x, df=10), data=MzWarKondrat)

grid <- MzWarKondrat %>% 
  data_grid(x = seq_range(x, n=50,expand = 0.1)) %>%
  gather_predictions(mod1,mod5, .pred = "y")

ggplot(MzWarKondrat, aes(x,y)) + 
  geom_point() +
  geom_line(data = grid,color ="red") + 
  facet_wrap(~ model)

```
model HoltWinters
```{r}
summary(train)
library(forecast)
library(dplyr)
pyly_MzWarKondrat <- train %>% select(MzWarKondratPM25_24g)

pylyHoltWinter <- ts(pyly_MzWarKondrat, frequency = 12, start = c(2013,1),end = c(2016,365))
pylyHoltWinter
pylyHoltWinter
pylyHoltWintersModel <- HoltWinters(pylyHoltWinter)
pylyHoltWintersModel
plot(pylyHoltWinter)
#install.packages("forecast")
#library(forecast)
#pyly_MzWarKondratPrognoza <- forecast.HoltWinters(pylyHoltWintersModel)
#plot(pyly_MzWarKondratPrognoza)

p <- forecast:::forecast.HoltWinters(pylyHoltWintersModel, h=1 )
plot(p)
#birthsForecast <- forecast.HoltWinters(birthsModel, h=24)
#plot(birthsForecast)
```


```{r}
cov(pogoda_pyly_imp$MzWarKondratPM25_24g,pogoda_pyly_imp$wilgotnosc)
```



xg boost
```{r}
library(xgboost)

```








